OCS Release Procedure
---------------------

The following steps (subject to change) are typically performed to prepare a new
OCS release:


1. Update version, installation, and upgrade descriptor files:

    dbscripts/xml/version.xml
    dbscripts/xml/install.xml
    dbscripts/xml/upgrade.xml

    Commands that may be helpful in determining what bugs have been closed
    since the last release (whose tag is specified in place of <last-tag>:

    cvs log -r<last-tag>::HEAD          # Generate a log from the last release
        | grep -o -e "^#\([0-9]\+\)#"   # Look for bug IDs in the commit notes
        | sed "s/#//g"                  # Remove the octothorpes
        | sort -n | uniq                # Get a unique sorted list
        > bug_ids.txt                   # Dump to a file

    The titles of these bugs can be fetched as follows:

    for id in `cat bug_ids.txt`; do
        wget -O - "http://pkp.sfu.ca/bugzilla/show_bug.cgi?id=$id"
        | grep -o -e "<title>.*<\/title>"
    ; done

    This can be done both for the application and for the PKP repository to
    ensure that all relevant commits (and all related bugs) are noted in the
    release notes.


2. Update release documentation:

    docs/README
    docs/release-notes/README-<VERSION>


3. Generate CVS ChangeLog for the release:

    perl lib/pkp/classes/cliTool/cvs2cl.pl --delta <OLD-TAG>:<CURRENT-TAG> -f \
        docs/release-notes/ChangeLog-<VERSION>


4. Copy the current changelog and release notes to docs/:

    cp docs/release-notes/ChangeLog-<VERSION> docs/ChangeLog
    cp docs/release-notes/README-<VERSION> docs/RELEASE


5. After committing any pending modifications, tag the release in CVS (both the
OCS codebase and the PKP library to be distributed with it):

    cvs rtag ocs-<MAJOR>_<MINOR>_<REVISION>-<BUILD> ocs2
    cvs rtag ocs-<MAJOR>_<MINOR>_<REVISION>-<BUILD> pkp


6. Build the OCS package and patch files:

    sh tools/buildpkg.sh <VERSION> <TAG> <PATCH_DIR>
    
    (<PATCH_DIR> is the path to a directory containing previous OCS release
     packages against which to build patches)


7. Place the new package, patches, version descriptor, and Doxygen docs on the
   OCS web site:

    http://pkp.sfu.ca/ocs/download/
    http://pkp.sfu.ca/ocs/download/patch/
    http://pkp.sfu.ca/ocs/xml/ocs-version.xml
    http://pkp.sfu.ca/ocs/doxygen
